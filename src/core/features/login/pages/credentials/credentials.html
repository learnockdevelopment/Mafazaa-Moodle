<ion-header class="ion-no-border">
    <ion-toolbar class="ion-no-border">
        <ion-buttons slot="start">
            <ion-back-button [text]="'core.back' | translate" />
        </ion-buttons>

        <ion-buttons slot="end">
            <ion-button fill="clear" (click)="openSettings()" [attr.aria-label]="'core.settings.appsettings' | translate">
                <ion-icon slot="icon-only" name="fas-gear" aria-hidden="true" />
            </ion-button>
            <ion-button fill="clear" (click)="showHelp()" [attr.aria-label]="'core.help' | translate">
                <ion-icon slot="icon-only" name="far-circle-question" aria-hidden="true" />
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>
<ion-content class="ion-padding">
    <core-loading [hideUntil]="pageLoaded">
        @if (!siteCheckError && site && credForm) {

            <!-- Header Section -->
            <div class="login-header">
                <div class="logo-container">
                    <img src="assets/img/login_logo.png" alt="App Logo" class="app-logo" />
                </div>
            </div>

            <!-- Login Form Section -->
            <div class="login-form-container">
                <h2 class="form-title">{{ 'core.login.login_title' | translate }}</h2>

                @if (exceededAttemptsHTML && supportConfig && loginAttempts >= 3) {
                    <core-login-exceeded-attempts [supportConfig]="supportConfig"
                        [supportSubject]="'core.login.exceededloginattemptssupportsubject' | translate">
                        <div [innerHTML]="exceededAttemptsHTML" (click)="exceededAttemptsClicked($event)"></div>
                    </core-login-exceeded-attempts>
                }

                @if (showLoginForm && !isBrowserSSO) {
                    <form [formGroup]="credForm" (ngSubmit)="login($event)" class="login-form" #credentialsForm>
                        <!-- Username Field -->
                        <div class="input-group">
                            <label class="input-label">{{ 'core.login.username' | translate }}</label>
                            <div class="input-container">
                                <ion-input type="text" name="username" [placeholder]="'core.login.username' | translate"
                                    formControlName="username" autocapitalize="none" autocorrect="off" autocomplete="username"
                                    enterkeyhint="next" required="true" class="custom-input" />
                                <ion-icon name="person-outline" class="input-icon"></ion-icon>
                            </div>
                        </div>

                        <!-- Password Field -->
                        <div class="input-group">
                            <label class="input-label">{{ 'core.login.password' | translate }}</label>
                            <div class="input-container">
                                <ion-input [type]="showPassword ? 'text' : 'password'" name="password" [placeholder]="'core.login.password_placeholder' | translate"
                                    formControlName="password" [clearOnEdit]="false" autocomplete="current-password" enterkeyhint="go"
                                    required="true" class="custom-input" />
                                <button type="button" class="password-toggle-icon" (click)="togglePasswordVisibility()">
                                    <ion-icon [name]="showPassword ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
                                </button>
                                <ion-icon name="lock-closed-outline" class="input-icon"></ion-icon>
                            </div>
                        </div>

                        <!-- Forgot Password Link -->
                        @if (showForgottenPassword) {
                            <div class="forgot-password-container">
                                <button type="button" class="forgot-password-link" (click)="forgottenPassword()">
                                    {{ 'core.login.forgot_password' | translate }}
                                </button>
                            </div>
                        }

                        <!-- Login Button -->
                        <ion-button expand="block" type="submit" [disabled]="!credForm.valid"
                            class="login-button">
                            {{ 'core.login.login_button' | translate }}
                        </ion-button>
                        <!-- Remove this once Ionic fixes this bug: https://github.com/ionic-team/ionic-framework/issues/19368 -->
                        <input type="submit" class="core-submit-hidden-enter" />
                    </form>
                }@else if (isBrowserSSO) {
                    <ion-button expand="block" (click)="openBrowserSSO()"
                        class="login-button">
                        {{ 'core.login.loginbutton' | translate }}
                        <ion-icon name="fas-up-right-from-square" slot="end" aria-hidden="true" />
                    </ion-button>
                    <p class="browser-description">{{ 'core.openinbrowserdescription' | translate }}</p>
                }


                <!-- Social Login Section -->
                @if (siteConfig) {
                    <core-login-methods [siteConfig]="siteConfig" [siteUrl]="site.siteUrl" [showLoginForm]="showLoginForm" />
                }
            </div>

            <!-- Sign Up Section -->
            @if (!isBrowserSSO && (canSignup || authInstructions)) {
                <div class="signup-section">
                    @if (authInstructions) {
                        <div class="auth-instructions">
                            <core-format-text [text]="authInstructions" [filter]="false" />
                        </div>
                    }

                    @if (canSignup) {
                        <div class="login-link-container">
                            <p>{{ 'core.login.no_account' | translate }} <button type="button" class="signup-button" (click)="openEmailSignup()">{{ 'core.login.create_account' | translate }}</button></p>
                        </div>
                    }
                </div>
            }

        }

        @if (siteCheckError) {
            <core-empty-box icon="fas-circle-exclamation" [message]="siteCheckError">
                <ion-button expand="block" (click)="checkSite()" fill="outline">
                    {{ 'core.tryagain' | translate }}
                </ion-button>
            </core-empty-box>
        }

    </core-loading>
</ion-content>
