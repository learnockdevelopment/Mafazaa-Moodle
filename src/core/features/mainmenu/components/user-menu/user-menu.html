<ion-header class="user-menu-header">
    <ion-toolbar class="user-menu-toolbar">
        <ion-title class="user-menu-title">
            <h1>{{'core.user.useraccount' | translate}}</h1>
        </ion-title>
        <ion-buttons slot="end">
            <ion-button fill="clear" class="close-btn" (click)="close($event)" [ariaLabel]="'core.close' | translate">
                <ion-icon name="close-outline" slot="icon-only" aria-hidden="true" />
            </ion-button>
        </ion-buttons>
    </ion-toolbar>
</ion-header>
<ion-content class="user-menu-content">
    <core-loading [hideUntil]="handlersLoaded" placeholderType="column" placeholderHeight="48px">
        <ion-list>
            @if (siteInfo) {
                <!-- User Profile Card (profile button removed as requested) -->
                <div class="user-profile-card">
                    <div class="profile-header">
                        <div class="profile-avatar" (click)="openUserProfile($event)">
                            <core-user-avatar [site]="siteInfo" [userId]="siteInfo.userid" [linkProfile]="false" />
                        </div>
                        <div class="profile-info">
                            <h2 class="profile-name">{{ siteInfo.fullname }}</h2>
                        </div>
                    </div>
                </div>
            }

            <div class="menu-section">
                <ion-item button *ngFor="let handler of handlers" class="menu-item ion-text-wrap" (click)="handlerClicked($event, handler)"
                    [ngClass]="['core-user-menu-handler', handler.class || '']" [hidden]="handler.hidden"
                    [attr.aria-label]="handler.title | translate" [detail]="false">
                    <div class="menu-item-content">
                        <div class="menu-item-icon">
                            @if (handler.icon) {
                                <ion-icon [name]="handler.icon" aria-hidden="true" />
                            } @else {
                                <ion-icon name="ellipse-outline" aria-hidden="true" />
                            }
                        </div>
                        <div class="menu-item-text">
                            <p class="item-heading">{{ handler.title | translate }}</p>
                        </div>
                        <div class="menu-item-badge">
                            @if (handler.showBadge) {
                                <ion-badge [hidden]="handler.loading || !handler.badge" aria-hidden="true">
                                    {{handler.badge}}
                                </ion-badge>
                                @if (handler.badge && handler.badgeA11yText) {
                                    <span class="sr-only">
                                        {{ handler.badgeA11yText | translate: {$a : handler.badge } }}
                                    </span>
                                }
                                @if (handler.loading) {
                                    <ion-spinner [attr.aria-label]="'core.loading' | translate" />
                                }
                            }
                        </div>
                    </div>
                </ion-item>
            </div>

            <div class="menu-section">
                <ion-item button *ngFor="let handler of accountHandlers" class="menu-item ion-text-wrap"
                    (click)="handlerClicked($event, handler)"
                    [ngClass]="['core-user-account-menu-handler', handler.class || '']"
                    [hidden]="handler.hidden" [attr.aria-label]="handler.title | translate" [detail]="false">
                    <div class="menu-item-content">
                        <div class="menu-item-icon">
                            @if (handler.icon) {
                                <ion-icon [name]="handler.icon" aria-hidden="true" />
                            } @else {
                                <ion-icon name="ellipse-outline" aria-hidden="true" />
                            }
                        </div>
                        <div class="menu-item-text">
                            <p class="item-heading">{{ handler.title | translate }}</p>
                        </div>
                        <div class="menu-item-badge">
                            @if (handler.showBadge) {
                                <ion-badge [hidden]="handler.loading || !handler.badge" aria-hidden="true">
                                    {{handler.badge}}
                                </ion-badge>
                                @if (handler.badge && handler.badgeA11yText) {
                                    <span class="sr-only">
                                        {{ handler.badgeA11yText | translate: {$a : handler.badge } }}
                                    </span>
                                }
                                @if (handler.loading) {
                                    <ion-spinner [attr.aria-label]="'core.loading' | translate" />
                                }
                            }
                        </div>
                    </div>
                </ion-item>

                <ion-item button class="menu-item" (click)="openPreferences($event)" [attr.aria-label]="'core.settings.preferences' | translate" [detail]="false">
                    <div class="menu-item-content">
                        <div class="menu-item-icon">
                            <ion-icon name="settings-outline" aria-hidden="true" />
                        </div>
                        <div class="menu-item-text">
                            <p class="item-heading">{{ 'core.settings.preferences' | translate }}</p>
                        </div>
                    </div>
                </ion-item>

                @if (displayContactSupport) {
                    <ion-item button class="menu-item" (click)="contactSupport($event)" [attr.aria-label]="'core.user.support' | translate" [detail]="false">
                        <div class="menu-item-content">
                            <div class="menu-item-icon">
                                <ion-icon name="mail-outline" aria-hidden="true" />
                            </div>
                            <div class="menu-item-text">
                                <p class="item-heading">{{ 'core.user.support' | translate }}</p>
                            </div>
                        </div>
                    </ion-item>
                }
            </div>
        </ion-list>
    </core-loading>
</ion-content>
<ion-footer class="user-menu-footer">
    <div class="footer-content">
        @if (displaySwitchAccount) {
            <ion-button fill="outline" class="switch-account-btn" (click)="switchAccounts($event)" [ariaLabel]="'core.mainmenu.switchaccount' | translate">
                <ion-icon name="swap-horizontal-outline" slot="start"></ion-icon>
                {{ 'core.mainmenu.switchaccount' | translate }}
            </ion-button>
        }
        <ion-button (click)="logout($event)" expand="block" class="logout-btn" [ariaLabel]="'core.mainmenu.logout' | translate">
            @if (!removeAccountOnLogout) {
                <ion-icon name="log-out-outline" slot="start"></ion-icon>
                {{ 'core.mainmenu.logout' | translate }}
            } @else {
                <ion-icon name="trash-outline" slot="start"></ion-icon>
                {{ 'core.login.removeaccount' | translate }}
            }
        </ion-button>
    </div>
</ion-footer>
